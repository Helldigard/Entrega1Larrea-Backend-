{{!< layouts/main}}

<h1>Lista de Productos</h1>
<ul>
    {{#each products}}
        <li>
            <h2>{{this.title}}</h2>
            <p>Precio: ${{this.price}}</p>
            <a href="/products/{{this.id}}">Ver detalles</a>
            <button onclick="addToCart('{{this.id}}')">Agregar al carrito</button>
        </li>
    {{/each}}
</ul>

<div>
    {{#if hasPrevPage}}
        <a href="/products?page={{prevPage}}&limit={{limit}}">Anterior</a>
    {{/if}}
    {{#if hasNextPage}}
        <a href="/products?page={{nextPage}}&limit={{limit}}">Siguiente</a>
    {{/if}}
</div>

<script>
    async function addToCart(productId) {
        try {
            const cartId = "64f1a2b3c9e77b001f8e4d9c";
            const response = await fetch(`/api/carts/${cartId}/products/${productId}`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
            });
            if (response.ok) {
                alert("Producto agregado al carrito");
            } else {
                alert("Error al agregar el producto al carrito");
            }
        } catch (error) {
            console.error(error);
        }
    }
</script>
<script>
    async function addToCart(productId) {
        try {
            const cartId = "{{cartId}}"; // Usa el ID del carrito pasado desde el servidor
            const response = await fetch(`/api/carts/${cartId}/products/${productId}`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
            });
            if (response.ok) {
                alert("Producto agregado al carrito");
            } else {
                alert("Error al agregar el producto al carrito");
            }
        } catch (error) {
            console.error(error);
        }
    }
</script>
